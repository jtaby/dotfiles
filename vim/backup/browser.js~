// ==========================================================================
// Project:   YouQueue.browserController
// Copyright: Â©2009 My Company, Inc.
// ==========================================================================
/*globals YouQueue */

/** @class

  (Document Your Controller Here)

  @extends SC.ObjecyController
*/
YouQueue.browserController = SC.ObjectController.create(
/** @scope YouQueue.browserController.prototype */ {

  // TODO: Add your own code here.
	queueIsSelected: NO,
	queueTitle: '',
	selectedPlaylistId: null,
	nowShowing: 'YouQueue.mainPage.libraryScene',
	
	showLibrary: function() {

		var path = 'libraryScene.browserContent.contentView';
		var view = YouQueue.mainPage.getPath(path);
		if(view && !view.get('isFirstResponder')){
			view.becomeFirstResponder();
		}		
		
		this.set('nowShowing','YouQueue.mainPage.libraryScene');
		this.set('queueIsSelected',NO);
	},
	
	showSelectedQueue: function() {
		var sel = YouQueue.libraryController.get('selection');
		if(!sel || !sel.get('length')) return;
				
		sel = sel.firstObject();
		
		var playlist_id = sel.get('id');

	  playlist_id = playlist_id.split('/');
		playlist_id = playlist_id[playlist_id.length-1];
		
		if(this.get('selectedPlaylistId') === playlist_id){
			this.set('nowShowing','YouQueue.mainPage.queueScene');
			this.set('queueIsSelected',YES);
			return;
		}
		
		this.set('selectedPlaylistId',playlist_id);
		
		YouQueue.libraryController.set('selectedLibrary',sel);
		
		var opts = {
			'uri': '/uq/playlists/'+playlist_id+'/medias',
			'postProcess': function(string){
				if(!string.hash) return;
				var ret = SC.json.decode(string.hash);
				ret.id = string.id;
				ret.playlist_id = string.playlist_id;
				return ret;
			}
		};

		var q = SC.Query.local(YouTube.Video, "playlist_id="+playlist_id,{ parameters: opts });
		// var q = SC.Query.local(YouTube.Video,{ params: opts });
	  var entries = YouQueue.store.find(q);
	  YouQueue.queueController.set('content',entries);
	
		this.set('queueTitle',sel.get('name'));
		this.set('nowShowing','YouQueue.mainPage.queueScene');
		this.set('queueIsSelected',YES);
	}
	
	
}) ;
